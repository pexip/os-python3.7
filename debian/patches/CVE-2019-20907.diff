From 79c6b602efc9a906c8496f3d5f4d54c54b48fa06 Mon Sep 17 00:00:00 2001
From: "Miss Islington (bot)"
 <31488909+miss-islington@users.noreply.github.com>
Date: Wed, 15 Jul 2020 05:35:08 -0700
Subject: [PATCH] bpo-39017: Avoid infinite loop in the tarfile module
 (GH-21454) (GH-21484)

Avoid infinite loop when reading specially crafted TAR files using the tarfile module
(CVE-2019-20907).
(cherry picked from commit 5a8d121a1f3ef5ad7c105ee378cc79a3eac0c7d4)

Co-authored-by: Rishi <rishi_devan@mail.com>

diff --git a/Lib/tarfile.py b/Lib/tarfile.py
index 3b596cbf49d27..3be5188c8b0a2 100755
--- a/Lib/tarfile.py
+++ b/Lib/tarfile.py
@@ -1233,6 +1233,8 @@ def _proc_pax(self, tarfile):
 
             length, keyword = match.groups()
             length = int(length)
+            if length == 0:
+                raise InvalidHeaderError("invalid header")
             value = buf[match.end(2) + 1:match.start(1) + length - 1]
 
             # Normally, we could just use "utf-8" as the encoding and "strict"
